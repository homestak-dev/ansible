---
- name: Set timezone
  ansible.builtin.command:
    cmd: timedatectl set-timezone {{ timezone }}
  changed_when: true
  when: timezone is defined

- name: Update apt cache
  ansible.builtin.apt:
    update_cache: true
    cache_valid_time: 3600

- name: Install common packages
  ansible.builtin.apt:
    name: "{{ common_packages }}"
    state: present

- name: Install extra packages for environment
  ansible.builtin.apt:
    name: "{{ extra_packages }}"
    state: present
  when: extra_packages | default([]) | length > 0

- name: Remove old kernels (optional cleanup)
  ansible.builtin.apt:
    autoremove: true
    purge: true
