---
# Configure inner PVE for nested VM provisioning
# Usage: ansible-playbook -i inventory/remote-dev.yml playbooks/inner-pve-setup.yml \
#          -e ansible_host=<IP> -e root_password_hash='$6$...'

- name: Configure inner PVE
  hosts: all
  gather_facts: true
  become: true

  pre_tasks:
    - name: Display target
      ansible.builtin.debug:
        msg: "Configuring inner PVE at {{ ansible_host }}"

  roles:
    - inner-pve

  post_tasks:
    - name: Display completion message
      ansible.builtin.debug:
        msg: |
          Inner PVE configuration complete!

          Next steps:
          1. Build packer image: ssh root@{{ ansible_host }} "cd /root/packer && packer build -force templates/debian-12-custom.pkr.hcl && ./publish.sh"
          2. Provision test VM: ssh root@{{ ansible_host }} "cd /root/tofu/envs/inner-test && tofu init && tofu apply"
