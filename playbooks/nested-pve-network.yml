---
# Configure network bridge on nested PVE
#
# Creates vmbr0 bridge (required after Debian-to-PVE conversion)
#
# Usage:
#   ansible-playbook -i inventory/remote-dev.yml playbooks/nested-pve-network.yml \
#     -e ansible_host=<IP>
#
# Variables (all auto-detected if not specified):
#   nested_pve_bridge_port: eth0
#   nested_pve_bridge_mode: dhcp  # or 'static'
#   nested_pve_bridge_address: 10.0.12.x  # if static
#   nested_pve_bridge_netmask: 255.255.255.0  # if static
#   nested_pve_bridge_gateway: 10.0.12.1  # if static

- name: Configure nested PVE networking
  hosts: all
  gather_facts: true
  become: true

  pre_tasks:
    - name: Display target
      ansible.builtin.debug:
        msg: "Configuring vmbr0 bridge on {{ ansible_host }}"

  tasks:
    - name: Include network setup tasks
      ansible.builtin.include_role:
        name: nested-pve
        tasks_from: network.yml

  post_tasks:
    - name: Display completion message
      ansible.builtin.debug:
        msg: "Network bridge configuration complete"
