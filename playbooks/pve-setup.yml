---
- name: Configure Proxmox PVE host
  hosts: proxmox
  gather_facts: true

  pre_tasks:
    - name: Display target environment
      ansible.builtin.debug:
        msg: "Configuring {{ inventory_hostname }} for {{ env_name | default('unknown') }} environment"

  roles:
    - homestak.debian.base
    - homestak.debian.security
    - homestak.proxmox.configure

  post_tasks:
    - name: Ensure vmbr0 bridge exists
      ansible.builtin.include_role:
        name: homestak.proxmox.networking
        tasks_from: bridge.yml

    - name: PVE setup complete
      ansible.builtin.debug:
        msg: "Proxmox PVE host {{ inventory_hostname }} configuration complete"
